<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const fsPromises = require('fs/promises');
const fetch = require('node-fetch');

let args = process.argv // arguments
main(args[2])

function main (fileName='./pokemon_names.txt') {
  readPokemonNamesFile(fileName) //right now we have [ 'bulbasaur', 'charmander']
    .then((pokemonArray) => { return fetchAllPokemon(pokemonArray)})
    .then((pokemon) => { return printPokemon(pokemon)})
    .then((finalPrint) => {console.log(finalPrint)});
}

/**
 * fetch all pokemon
 *
 * @param {*} pokemonArray an array of pokemon names
 * @returns an array of all fetches from the pokemon API
 */
function fetchAllPokemon (pokemonArray) {
  return Promise.all(pokemonArray.map((pokemon) => {
    return fetchPokeAPI (pokemon);
  }));
}

/**
 * returns a promise with an array of pokemon names read from the input file
 * @param {*} file the file path to read from
 * @returns Promise array of pokemon names
 */
function readPokemonNamesFile (file) {
  return fsPromises.readFile(file, 'utf8')
    .then((fileData) => { return fileData.split('\n') })
}

/**
 * Returns an individual promise with data from the poke api get request
 *
 * @param {*} name the name of the pokemon you want to fetch
 * @returns Promise the response data from fetch
 * @throws any invalid pokemon names will be caught here and resolves as null
 */
function fetchPokeAPI (name) {
  return new Promise((resolve, reject) => {
    let url = `https://pokeapi.co/api/v2/pokemon/${name}`
    fetch(url)
      .then((response) => {
        if (response.ok) {
          return response.json()
        } else {
          throw `invalid pokemon: ${name}`;
        }
      })
      .then((response) => {
        let types = response.types.map(typeSlot => {
          return typeSlot.type.name
        });
        resolve({name, types});

      })
      .catch((err) => {
        console.error(err)
        resolve(null);
      });
  })
}

/**
 * Takes in an array of objects including pokemon data
 * and prints it correct
 * @param {*} pokemon the array of pokemon objects
 * @returns String Charizard: flying, fire
 */
function printPokemon (pokemon) {
  return pokemon.map((pokemonRow) => {
    if (pokemonRow) {
      return `${pokemonRow.name}: ${pokemonRow.types.join(", ")}`
    }
  }).join('\n');
}

//extra time
//write test suite with mocha and chai
//rebuild using the node wrapper
//dynamically define input file
//pre-check input names before making individual call
// node wrapped API: https://github.com/PokeAPI/pokedex-promise-v2

// 1) Add error handling for "bad arguments" using .catch().
// * What happens if I pass in a non-existent file?
// * What happens if I pass in NO arguments

// 2) Log the output of the HTTP pokemon to a JSON file called "PokemonAttributes".
//  * If the pokemon is already on your attribute list - then return the pokemon from the PokemonAttributes file instead of making a costly HTTP call.

// 3) Accept an argument (T or F) that checks if the first two pokemon were to fight - which pokemon would have the advantage (based on types).
//  * Check out damage_relations in the Pokemon.Type section
//      https://pokeapi.co/docs/v2#types
//  * If pokemon1 would have the advantage log out something like "Bulbasaur has the advantage over Goldeen".

// 4) Some other fun functionality you and you partner agree to!
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#fetchAllPokemon">fetchAllPokemon</a></li><li><a href="global.html#fetchPokeAPI">fetchPokeAPI</a></li><li><a href="global.html#printPokemon">printPokemon</a></li><li><a href="global.html#readPokemonNamesFile">readPokemonNamesFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Jul 13 2021 16:39:11 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
